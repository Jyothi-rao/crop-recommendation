import React, { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Separator } from '@/components/ui/separator';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Wheat, Users, Globe, Wifi, WifiOff, Lightbulb, Camera, IndianRupee, Leaf, Mic } from 'lucide-react';
import { LanguageProvider, LanguageSelector, useLanguage } from '../components/LanguageSelector';
import { CropRecommendationComponent } from '../components/CropRecommendation';
import { WeatherWidget } from '../components/WeatherWidget';
import { PlantDiseaseDetection } from '../components/PlantDiseaseDetection';
import { NaturalRemedies } from '../components/NaturalRemedies';
import { MarketPrices } from '../components/MarketPrices';
import { VoiceAssistant } from '../components/VoiceAssistant';
import { useOfflineStorage } from '../hooks/useOfflineStorage';
import { CropRecommendationEngine } from '../lib/cropRecommendationEngine';

const MainContent: React.FC = () => {
  const { t } = useLanguage();
  const { isOnline, storedRecommendations } = useOfflineStorage();
  const [selectedState, setSelectedState] = useState('Telangana');
  const [selectedCrop, setSelectedCrop] = useState('rice');
  const [activeTab, setActiveTab] = useState('recommendations');

  const seasonalTips = CropRecommendationEngine.getSeasonalTips('kharif', 'en');

  return (
    <div className="min-h-screen bg-gradient-to-br from-green-50 to-blue-50">
      {/* Header */}
      <header className="bg-white shadow-sm border-b">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="bg-green-600 p-2 rounded-lg">
                <Wheat className="h-6 w-6 text-white" />
              </div>
              <div>
                <h1 className="text-xl font-bold text-gray-900">{t('appTitle')}</h1>
                <p className="text-sm text-gray-600">Smart Agriculture for Indian Farmers</p>
              </div>
            </div>
            
            <div className="flex items-center gap-4">
              <div className="flex items-center gap-2">
                {isOnline ? (
                  <Wifi className="h-4 w-4 text-green-600" />
                ) : (
                  <WifiOff className="h-4 w-4 text-orange-600" />
                )}
                <span className="text-sm text-muted-foreground">
                  {isOnline ? 'Online' : 'Offline'}
                </span>
              </div>
              <LanguageSelector />
            </div>
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Welcome Section */}
        <div className="mb-8">
          <div className="text-center space-y-4">
            <h2 className="text-3xl font-bold text-gray-900">{t('welcome')}</h2>
            <p className="text-lg text-gray-600 max-w-3xl mx-auto">
              Get personalized crop recommendations, detect plant diseases with camera, find natural remedies, 
              and check market prices. Voice-enabled and available in Telugu, Hindi, and English.
            </p>
            
            <div className="flex flex-wrap justify-center gap-2 mt-4">
              <Badge variant="secondary" className="flex items-center gap-1">
                <Users className="h-3 w-3" />
                Farmer-Centric
              </Badge>
              <Badge variant="secondary" className="flex items-center gap-1">
                <Globe className="h-3 w-3" />
                Multi-Language
              </Badge>
              <Badge variant="secondary" className="flex items-center gap-1">
                <WifiOff className="h-3 w-3" />
                Offline Ready
              </Badge>
              <Badge variant="secondary" className="flex items-center gap-1">
                <Camera className="h-3 w-3" />
                Camera Capture
              </Badge>
              <Badge variant="secondary" className="flex items-center gap-1">
                <Mic className="h-3 w-3" />
                Voice Assistant
              </Badge>
              <Badge variant="secondary" className="flex items-center gap-1">
                <Leaf className="h-3 w-3" />
                Natural Remedies
              </Badge>
              <Badge variant="secondary" className="flex items-center gap-1">
                <IndianRupee className="h-3 w-3" />
                Market Prices
              </Badge>
            </div>
          </div>
        </div>

        {/* Main Tabs */}
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="grid w-full grid-cols-2 lg:grid-cols-5">
            <TabsTrigger value="recommendations" className="flex items-center gap-2">
              <Wheat className="h-4 w-4" />
              <span className="hidden sm:inline">Crop Recommendations</span>
              <span className="sm:hidden">Crops</span>
            </TabsTrigger>
            <TabsTrigger value="disease-detection" className="flex items-center gap-2">
              <Camera className="h-4 w-4" />
              <span className="hidden sm:inline">Disease Detection</span>
              <span className="sm:hidden">Disease</span>
            </TabsTrigger>
            <TabsTrigger value="natural-remedies" className="flex items-center gap-2">
              <Leaf className="h-4 w-4" />
              <span className="hidden sm:inline">Natural Remedies</span>
              <span className="sm:hidden">Remedies</span>
            </TabsTrigger>
            <TabsTrigger value="market-prices" className="flex items-center gap-2">
              <IndianRupee className="h-4 w-4" />
              <span className="hidden sm:inline">Market Prices</span>
              <span className="sm:hidden">Prices</span>
            </TabsTrigger>
            <TabsTrigger value="weather" className="flex items-center gap-2">
              <Lightbulb className="h-4 w-4" />
              <span className="hidden sm:inline">Weather & Tips</span>
              <span className="sm:hidden">Weather</span>
            </TabsTrigger>
          </TabsList>

          {/* Crop Recommendations Tab */}
          <TabsContent value="recommendations">
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
              <div className="lg:col-span-2">
                <CropRecommendationComponent />
                
                {/* Recent Recommendations */}
                {storedRecommendations.length > 0 && (
                  <Card className="mt-6">
                    <CardHeader>
                      <CardTitle>Recent Recommendations</CardTitle>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-3">
                        {storedRecommendations.slice(0, 3).map((rec) => (
                          <div key={rec.id} className="border rounded-lg p-3">
                            <div className="flex items-center justify-between mb-2">
                              <div className="text-sm font-medium">{rec.state}</div>
                              <div className="text-xs text-muted-foreground">
                                {new Date(rec.timestamp).toLocaleDateString()}
                              </div>
                            </div>
                            <div className="text-xs text-muted-foreground">
                              {rec.recommendations.length} crops recommended
                            </div>
                          </div>
                        ))}
                      </div>
                    </CardContent>
                  </Card>
                )}
              </div>

              <div className="space-y-6">
                <WeatherWidget state={selectedState} />
                
                {/* Voice Assistant Info */}
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Mic className="h-5 w-5 text-blue-500" />
                      Voice Assistant
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="text-sm text-muted-foreground">
                      Use voice commands to navigate the app. Click the microphone button in the bottom-right corner.
                    </div>
                    <div className="space-y-2 text-xs">
                      <div className="font-medium">Try saying:</div>
                      <div className="text-muted-foreground">"Crop recommendation"</div>
                      <div className="text-muted-foreground">"Disease detection"</div>
                      <div className="text-muted-foreground">"Market prices"</div>
                      <div className="text-muted-foreground">"Capture photo"</div>
                    </div>
                  </CardContent>
                </Card>

                {/* Quick Features */}
                <Card>
                  <CardHeader>
                    <CardTitle>Key Features</CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="flex items-start gap-3">
                      <div className="bg-green-100 p-1 rounded">
                        <Wheat className="h-4 w-4 text-green-600" />
                      </div>
                      <div className="text-sm">
                        <div className="font-medium">AI-Powered Recommendations</div>
                        <div className="text-muted-foreground">Based on soil, weather, and regional data</div>
                      </div>
                    </div>
                    
                    <div className="flex items-start gap-3">
                      <div className="bg-blue-100 p-1 rounded">
                        <Camera className="h-4 w-4 text-blue-600" />
                      </div>
                      <div className="text-sm">
                        <div className="font-medium">Camera Disease Detection</div>
                        <div className="text-muted-foreground">Capture photos for instant plant analysis</div>
                      </div>
                    </div>
                    
                    <div className="flex items-start gap-3">
                      <div className="bg-purple-100 p-1 rounded">
                        <Mic className="h-4 w-4 text-purple-600" />
                      </div>
                      <div className="text-sm">
                        <div className="font-medium">Voice Control</div>
                        <div className="text-muted-foreground">Navigate using voice commands</div>
                      </div>
                    </div>
                    
                    <div className="flex items-start gap-3">
                      <div className="bg-orange-100 p-1 rounded">
                        <WifiOff className="h-4 w-4 text-orange-600" />
                      </div>
                      <div className="text-sm">
                        <div className="font-medium">Offline Functionality</div>
                        <div className="text-muted-foreground">Works without internet connection</div>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>
            </div>
          </TabsContent>

          {/* Disease Detection Tab */}
          <TabsContent value="disease-detection">
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
              <div className="lg:col-span-2">
                <PlantDiseaseDetection />
              </div>
              <div className="space-y-6">
                <WeatherWidget state={selectedState} />
                
                <Card>
                  <CardHeader>
                    <CardTitle>How It Works</CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="flex items-start gap-3">
                      <div className="bg-blue-100 p-1 rounded">
                        <Camera className="h-4 w-4 text-blue-600" />
                      </div>
                      <div className="text-sm">
                        <div className="font-medium">1. Capture or Upload</div>
                        <div className="text-muted-foreground">Use camera to capture or upload existing photo</div>
                      </div>
                    </div>
                    
                    <div className="flex items-start gap-3">
                      <div className="bg-green-100 p-1 rounded">
                        <Lightbulb className="h-4 w-4 text-green-600" />
                      </div>
                      <div className="text-sm">
                        <div className="font-medium">2. AI Analysis</div>
                        <div className="text-muted-foreground">Our AI identifies diseases and pests</div>
                      </div>
                    </div>
                    
                    <div className="flex items-start gap-3">
                      <div className="bg-purple-100 p-1 rounded">
                        <Leaf className="h-4 w-4 text-purple-600" />
                      </div>
                      <div className="text-sm">
                        <div className="font-medium">3. Get Solutions</div>
                        <div className="text-muted-foreground">Receive treatment recommendations and pesticide links</div>
                      </div>
                    </div>

                    <div className="flex items-start gap-3">
                      <div className="bg-red-100 p-1 rounded">
                        <Mic className="h-4 w-4 text-red-600" />
                      </div>
                      <div className="text-sm">
                        <div className="font-medium">4. Voice Commands</div>
                        <div className="text-muted-foreground">Say "capture photo" to take pictures hands-free</div>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>
            </div>
          </TabsContent>

          {/* Natural Remedies Tab */}
          <TabsContent value="natural-remedies">
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
              <div className="lg:col-span-2">
                <NaturalRemedies cropId={selectedCrop} />
              </div>
              <div className="space-y-6">
                <Card>
                  <CardHeader>
                    <CardTitle>Select Crop for Remedies</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="grid gap-2">
                      {['rice', 'wheat', 'cotton', 'maize', 'sugarcane'].map((crop) => (
                        <button
                          key={crop}
                          onClick={() => setSelectedCrop(crop)}
                          className={`p-3 text-left rounded-lg border transition-colors ${
                            selectedCrop === crop
                              ? 'border-green-500 bg-green-50'
                              : 'border-gray-200 hover:border-green-300'
                          }`}
                        >
                          <div className="font-medium capitalize">{crop}</div>
                        </button>
                      ))}
                    </div>
                  </CardContent>
                </Card>

                <Card>
                  <CardHeader>
                    <CardTitle>Benefits of Natural Remedies</CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    <div className="flex items-start gap-3">
                      <div className="bg-green-100 p-1 rounded">
                        <Leaf className="h-4 w-4 text-green-600" />
                      </div>
                      <div className="text-sm">
                        <div className="font-medium">Eco-Friendly</div>
                        <div className="text-muted-foreground">Safe for environment and beneficial insects</div>
                      </div>
                    </div>
                    
                    <div className="flex items-start gap-3">
                      <div className="bg-blue-100 p-1 rounded">
                        <IndianRupee className="h-4 w-4 text-blue-600" />
                      </div>
                      <div className="text-sm">
                        <div className="font-medium">Cost-Effective</div>
                        <div className="text-muted-foreground">Made from easily available ingredients</div>
                      </div>
                    </div>
                    
                    <div className="flex items-start gap-3">
                      <div className="bg-purple-100 p-1 rounded">
                        <Users className="h-4 w-4 text-purple-600" />
                      </div>
                      <div className="text-sm">
                        <div className="font-medium">Safe for Farmers</div>
                        <div className="text-muted-foreground">No harmful chemical exposure</div>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>
            </div>
          </TabsContent>

          {/* Market Prices Tab */}
          <TabsContent value="market-prices">
            <MarketPrices />
          </TabsContent>

          {/* Weather & Tips Tab */}
          <TabsContent value="weather">
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
              <div className="lg:col-span-2 space-y-6">
                <WeatherWidget state={selectedState} />
                
                {/* Farming Tips */}
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Lightbulb className="h-5 w-5 text-yellow-500" />
                      {t('tips')}
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="space-y-3">
                      {seasonalTips.map((tip, index) => (
                        <div key={index} className="text-sm p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-400">
                          {tip}
                        </div>
                      ))}
                    </div>
                    
                    <Separator className="my-4" />
                    
                    <div className="text-sm p-3 bg-blue-50 rounded-lg border-l-4 border-blue-400">
                      {t('soilTesting')}
                    </div>
                  </CardContent>
                </Card>
              </div>

              <div className="space-y-6">
                <Card>
                  <CardHeader>
                    <CardTitle>Select State for Weather</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="grid gap-2 max-h-64 overflow-y-auto">
                      {['Telangana', 'Andhra Pradesh', 'Karnataka', 'Tamil Nadu', 'Maharashtra', 'Gujarat', 'Punjab', 'Haryana'].map((state) => (
                        <button
                          key={state}
                          onClick={() => setSelectedState(state)}
                          className={`p-2 text-left rounded border transition-colors ${
                            selectedState === state
                              ? 'border-blue-500 bg-blue-50'
                              : 'border-gray-200 hover:border-blue-300'
                          }`}
                        >
                          <div className="text-sm font-medium">{state}</div>
                        </button>
                      ))}
                    </div>
                  </CardContent>
                </Card>
              </div>
            </div>
          </TabsContent>
        </Tabs>
      </main>

      {/* Voice Assistant */}
      <VoiceAssistant
        onSwitchTab={setActiveTab}
        onCropRecommendation={() => setActiveTab('recommendations')}
        onDiseaseDetection={() => setActiveTab('disease-detection')}
        onNaturalRemedies={() => setActiveTab('natural-remedies')}
        onMarketPrices={() => setActiveTab('market-prices')}
        onWeather={() => setActiveTab('weather')}
      />

      {/* Footer */}
      <footer className="bg-white border-t mt-16">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <div className="text-center text-sm text-gray-600">
            <p>AI-Based Crop Recommendation System for Indian Farmers</p>
            <p className="mt-2">Built for SIH25030 - Lightweight, Offline-Ready, and Government Scalable</p>
            <p className="mt-2">Features: Crop Recommendations • Camera Disease Detection • Voice Assistant • Natural Remedies • Market Prices</p>
          </div>
        </div>
      </footer>
    </div>
  );
};

export default function Index() {
  return (
    <LanguageProvider>
      <MainContent />
    </LanguageProvider>
  );
}
